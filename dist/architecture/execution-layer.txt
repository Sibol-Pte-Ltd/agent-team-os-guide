1:"$Sreact.fragment"
2:I[9766,[],""]
3:I[8924,[],""]
4:I[3370,["2619","static/chunks/2619-3c9e02e22d10480a.js","7340","static/chunks/app/(authenticated)/layout-5903556f4d514608.js"],"default"]
5:I[5589,["2619","static/chunks/2619-3c9e02e22d10480a.js","7340","static/chunks/app/(authenticated)/layout-5903556f4d514608.js"],"default"]
9:I[7150,[],""]
:HL["/_next/static/css/7551ba5c13ed1c7f.css","style"]
6:T2909,<div class="breadcrumbs">
          <a href="/">Home</a>
          <span class="separator">/</span>
          <a href="/architecture">Architecture</a>
          <span class="separator">/</span>
          Execution Layer
        </div>

        <h1>Execution Layer</h1>

        <p>The Execution Layer is where intentions become actions. When the Agent Runner's LLM decides to read a file, run a command, search the web, or click a button in a browser, the Execution Layer is what actually carries out that operation. It provides a controlled, sandboxed environment for tool execution and returns structured results back to the Agent Runner for the next reasoning step.</p>

        <p>The Execution Layer is not a single module — it is a collection of tool implementations that share common patterns: input validation, environment control, output capture, error handling, and security gating.</p>

        <h2>Tool Categories</h2>

        <p>OpenClaw's tools fall into several categories, each with its own execution characteristics:</p>

        <h3>File Operations</h3>

        <p>The core coding tools that let agents read, write, and edit files:</p>

        <ul>
          <li><strong>read</strong> — read file contents with offset/limit support for large files; handles both text files and images (images are sent as attachments to the LLM)</li>
          <li><strong>write</strong> — create or overwrite files, automatically creating parent directories</li>
          <li><strong>edit</strong> — surgical text replacement: find an exact string in a file and replace it with new text</li>
        </ul>

        <p>File tools are sandboxed to the agent's workspace directory. Path traversal outside the workspace is blocked. Read operations support pagination for large files — the agent can read a file in chunks rather than loading the entire thing into context.</p>

        <h3>Shell Execution</h3>

        <p>The <code>exec</code> tool runs shell commands and the <code>process</code> tool manages long-running processes:</p>

        <ul>
          <li><strong>exec</strong> — execute a shell command with configurable timeout, working directory, environment variables, and background mode. Supports PTY mode for interactive terminal applications.</li>
          <li><strong>process</strong> — manage background processes: list active sessions, poll for output, write stdin, send keystrokes, kill processes. Essential for long-running development servers, test suites, and interactive CLIs.</li>
        </ul>

        <p>Shell execution includes several safety mechanisms:</p>

        <ul>
          <li><strong>Security modes</strong> — <code>deny</code> (no exec), <code>allowlist</code> (only pre-approved commands), or <code>full</code> (unrestricted)</li>
          <li><strong>Exec approval</strong> — commands can require human approval before execution, with a configurable timeout</li>
          <li><strong>Ask mode</strong> — the agent can be configured to ask the user before running potentially destructive commands</li>
          <li><strong>Path sanitization</strong> — PATH is controlled and safe binaries are resolved explicitly</li>
          <li><strong>Output truncation</strong> — command output is truncated to a configurable maximum to prevent context overflow</li>
          <li><strong>Timeout enforcement</strong> — commands are killed after their timeout expires</li>
        </ul>

        <h3>Browser Automation</h3>

        <p>The browser tool provides full web automation capabilities via Playwright:</p>

        <ul>
          <li><strong>Navigation</strong> — open URLs, navigate between pages</li>
          <li><strong>Snapshots</strong> — capture the accessibility tree (structured page content) for the LLM to reason about</li>
          <li><strong>Screenshots</strong> — capture visual screenshots when the accessibility tree is insufficient</li>
          <li><strong>Actions</strong> — click elements, type text, press keys, hover, drag, select options, fill forms</li>
          <li><strong>Tabs</strong> — open, close, switch between, and list browser tabs</li>
          <li><strong>PDF generation</strong> — convert pages to PDF</li>
          <li><strong>Console access</strong> — read browser console output for debugging</li>
        </ul>

        <p>The browser can run in multiple profiles — an isolated OpenClaw-managed browser, or via Chrome Extension relay that connects to the user's existing Chrome tabs. Browser sessions persist across tool calls within a run, so the agent can navigate, interact, and observe across multiple steps.</p>

        <h3>Web Operations</h3>

        <ul>
          <li><strong>web_search</strong> — search the web using Brave Search API, returning titles, URLs, and snippets</li>
          <li><strong>web_fetch</strong> — fetch and extract readable content from a URL, converting HTML to markdown</li>
        </ul>

        <h3>Messaging &amp; Channel Tools</h3>

        <ul>
          <li><strong>message</strong> — send messages, manage channels, create threads, upload emoji, manage polls, and perform other channel operations on the current platform</li>
          <li><strong>tts</strong> — convert text to speech for voice message delivery</li>
        </ul>

        <h3>System &amp; Agent Tools</h3>

        <ul>
          <li><strong>OpenClaw tools</strong> — session management, subagent spawning, agent coordination, Gateway control</li>
          <li><strong>Node tools</strong> — interact with paired mobile devices: camera, location, notifications, screen recording</li>
          <li><strong>Canvas tools</strong> — present visual content to users via rendered HTML/React canvases</li>
          <li><strong>Memory tools</strong> — <code>memory_search</code> and <code>memory_get</code> for semantic search and retrieval from the agent's long-term memory files. Powered by <code>embeddinggemma-300m-qat-Q8_0</code> with per-agent SQLite indexes, auto-reindexed every 6 hours via cron.</li>
          <li><strong>Image analysis</strong> — analyze images using a vision model</li>
        </ul>

        <h2>Sandbox Architecture</h2>

        <p>For enhanced isolation, OpenClaw supports running tool execution inside Docker containers (sandboxes). The sandbox system provides:</p>

        <ul>
          <li><strong>Workspace mounting</strong> — the agent's workspace directory is mounted into the container, so file operations work as expected</li>
          <li><strong>Network isolation</strong> — sandboxed commands can be restricted from network access</li>
          <li><strong>Resource limits</strong> — CPU, memory, and disk usage can be constrained</li>
          <li><strong>Disposability</strong> — containers can be pruned and recreated without affecting the host system</li>
          <li><strong>Browser sandboxing</strong> — browser automation can run in a separate container with its own display server</li>
        </ul>

        <p>Sandbox configuration is per-agent: one agent might run fully sandboxed while another runs directly on the host, depending on the trust level and use case.</p>

        <h2 id="tool-policy">Tool Policy &amp; Filtering</h2>

        <p>Not every tool is available to every agent in every context. The Execution Layer applies policy-based filtering:</p>

        <ul>
          <li><strong>Tool allowlists</strong> — agents can be restricted to a specific set of tools</li>
          <li><strong>Owner-only tools</strong> — certain tools (like Gateway management) are restricted to the system owner</li>
          <li><strong>Subagent policies</strong> — spawned subagents can inherit or override the parent's tool policy</li>
          <li><strong>Plugin tools</strong> — external plugins can register additional tools that are subject to the same policy system</li>
          <li><strong>Per-channel tool visibility</strong> — some tools may only be available on certain channels</li>
        </ul>

        <h2>How It Works in Code</h2>

        <p>Tool implementations are distributed across several modules in <code>src/agents/</code>:</p>

        <ul>
          <li><code>bash-tools.exec.ts</code> — the exec tool: command execution with approval, sandboxing, and output management</li>
          <li><code>bash-tools.process.ts</code> — the process tool: background process management (list, poll, write, send-keys, kill)</li>
          <li><code>pi-tools.read.ts</code> — file operation tools (read, write, edit) with sandboxing support</li>
          <li><code>channel-tools.ts</code> — messaging and channel management tools</li>
          <li><code>openclaw-tools.ts</code> — session management, subagent spawning, and Gateway tools</li>
          <li><code>tools/</code> — additional tool implementations (nodes, browser delegation, etc.)</li>
        </ul>

        <p>The browser automation system lives in <code>src/browser/</code> with its own server, Playwright session management, CDP integration, and Chrome extension relay.</p>

        <p>Tool schemas and policy filtering are handled by <code>pi-tools.ts</code> (catalog construction), <code>pi-tools.schema.ts</code> (schema normalization for different LLM providers), and <code>tool-policy.ts</code> (allowlist/blocklist resolution).</p>

        <div class="callout tip">
          <div class="callout-title">Everything Is a Tool</div>
          <p>One of OpenClaw's key design decisions is that nearly every capability is exposed as a tool. The LLM doesn't have special built-in abilities — it can only reason about text and request tool calls. This uniformity means adding new capabilities is straightforward: implement a tool function, define its schema, register it in the catalog, and the agent can immediately use it. The same mechanism that lets an agent read a file also lets it send a Discord message, snap a photo on your phone, or spawn a subagent to handle a complex task.</p>
        </div>

        <div class="action-section">
          <h2>Next</h2>
          <ul>
            <li><a href="/architecture">Architecture Overview</a> — see how all five components connect</li>
            <li><a href="/architecture/agent-runner">Agent Runner</a> — what decides which tools to call</li>
            <li><a href="/architecture/channel-adapters">Channel Adapters</a> — start from the beginning of the pipeline</li>
          </ul>
        </div>0:{"P":null,"b":"2KJOuiIHHn1XBSYY3qBe8","p":"","c":["","architecture","execution-layer"],"i":false,"f":[[["",{"children":["(authenticated)",{"children":["architecture",{"children":["execution-layer",{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/7551ba5c13ed1c7f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}],{"children":["(authenticated)",["$","$1","c",{"children":[null,["$","body",null,{"children":[["$","input",null,{"type":"checkbox","id":"menu-toggle","className":"menu-toggle"}],["$","label",null,{"htmlFor":"menu-toggle","className":"hamburger","aria-label":"Toggle navigation","children":"☰"}],["$","label",null,{"htmlFor":"menu-toggle","className":"overlay"}],["$","div",null,{"className":"site-wrapper","children":[["$","$L4",null,{}],["$","main",null,{"className":"main-content","children":["$","div",null,{"className":"content-wrapper","children":[["$","$L5",null,{}],["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":"$0:f:0:1:1:props:children:1:props:children:props:notFound:0:1:props:style","children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":"$0:f:0:1:1:props:children:1:props:children:props:notFound:0:1:props:children:props:children:1:props:style","children":404}],["$","div",null,{"style":"$0:f:0:1:1:props:children:1:props:children:props:notFound:0:1:props:children:props:children:2:props:style","children":["$","h2",null,{"style":"$0:f:0:1:1:props:children:1:props:children:props:notFound:0:1:props:children:props:children:2:props:children:props:style","children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]]}]}]]}]]}]]}],{"children":["architecture",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["execution-layer",["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":[["$","div",null,{"dangerouslySetInnerHTML":{"__html":"$6"}}],null,"$L7"]}],{},null,false]},null,false]},null,false]},null,false]},null,false],"$L8",false]],"m":"$undefined","G":["$9",[]],"s":false,"S":true}
a:I[4431,[],"OutletBoundary"]
c:I[5278,[],"AsyncMetadataOutlet"]
e:I[4431,[],"ViewportBoundary"]
10:I[4431,[],"MetadataBoundary"]
11:"$Sreact.suspense"
7:["$","$La",null,{"children":["$Lb",["$","$Lc",null,{"promise":"$@d"}]]}]
8:["$","$1","h",{"children":[null,[["$","$Le",null,{"children":"$Lf"}],null],["$","$L10",null,{"children":["$","div",null,{"hidden":true,"children":["$","$11",null,{"fallback":null,"children":"$L12"}]}]}]]}]
f:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
b:null
d:{"metadata":[["$","title","0",{"children":"Execution Layer — OpenClaw Architecture"}],["$","meta","1",{"name":"description","content":"Your personal AI agent team, working together to keep your life organized."}]],"error":null,"digest":"$undefined"}
12:"$d:metadata"
